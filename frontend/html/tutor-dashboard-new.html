<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassGo - Panel de Tutor</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/tutor-dashboard.css?v=101">
    <link rel="stylesheet" href="/css/mobile-optimizations.css?v=1">
</head>
<body>
    <!-- Decorative Background -->
    <div class="bg-circle bg-circle-1"></div>
    <div class="bg-circle bg-circle-2"></div>
    <div class="bg-circle bg-circle-3"></div>

    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo-circle">
                <div class="logo-icon"></div>
            </div>
            <h1 class="logo-text">ClassGo</h1>
        </div>
        <div class="header-info">
            <div class="tutor-badge">üéì Tutor</div>
            <div class="user-avatar" onclick="toggleUserMenu(event)" id="userAvatar">
                <span id="avatarText">T</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Welcome Section -->
        <section class="welcome-section">
            <h2 class="welcome-title" id="welcomeTitle">¬°Bienvenido, Tutor! üéì</h2>
            <p class="welcome-subtitle" id="welcomeSubtitle">Gestiona tus cursos y estudiantes</p>
        </section>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-info">
                    <div class="stat-value" id="totalCourses">0</div>
                    <div class="stat-label">Cursos Creados</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <div class="stat-value" id="totalStudents">0</div>
                    <div class="stat-label">Estudiantes Activos</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-info">
                    <div class="stat-value" id="upcomingClasses">0</div>
                    <div class="stat-label">Clases Programadas</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-info">
                    <div class="stat-value" id="avgRating">5.0</div>
                    <div class="stat-label">Calificaci√≥n Promedio</div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchSection('courses')">Mis Cursos</div>
            <div class="nav-tab" onclick="switchSection('schedule')">Calendario</div>
            <div class="nav-tab" onclick="switchSection('messages')">Mensajes</div>
            <div class="nav-tab" onclick="switchSection('resources')">Recursos</div>
        </div>

        <!-- Mis Cursos Section -->
        <div id="coursesSection" class="content-section active">
            <div class="section-header">
                <h2>Mis Cursos</h2>
                <button class="btn-primary" onclick="openCreateCourseModal()">Crear Nuevo Curso</button>
            </div>
            <div id="coursesGrid" class="courses-grid">
                <!-- Courses will be loaded here -->
            </div>
        </div>

        <!-- Calendario Section -->
        <div id="scheduleSection" class="content-section">
            <h2>Calendario de Clases</h2>
            <div class="calendar-legend">
                <div class="legend-item">
                    <span class="legend-dot open"></span>
                    <span>Abierta (programada)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot upcoming"></span>
                    <span>Pr√≥xima (2 d√≠as o menos)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot overdue"></span>
                    <span>Vencida (no completada)</span>
                </div>
            </div>
            <div class="calendar-layout">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button onclick="previousMonth()">‚Äπ</button>
                        <h3 id="currentMonth">Mes A√±o</h3>
                        <button onclick="nextMonth()">‚Ä∫</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
                <div class="upcoming-classes">
                    <h3>Pr√≥ximas Clases</h3>
                    <div id="upcomingClassesList"></div>
                </div>
            </div>
        </div>

        <!-- Mensajes Section -->
        <div id="messagesSection" class="content-section">
            <h2>Mensajes</h2>
            
            <div class="messages-container">
                <div class="conversations-panel">
                    <input type="text" id="searchConversations" placeholder="üîç Buscar contactos..." class="search-input">
                    <div id="conversationsList" class="conversations-list">
                        <!-- Contacts will be loaded here -->
                    </div>
                </div>
                
                <div class="chat-panel">
                    <div class="chat-header" style="display: none;">
                        <h4>Selecciona un contacto</h4>
                    </div>
                    <div id="messagesContainer" class="messages-container">
                        <div class="empty-state">Selecciona un estudiante para comenzar a conversar</div>
                    </div>
                    <div class="message-input-container">
                        <input type="text" id="messageInput" placeholder="Escribe un mensaje..." class="message-input">
                        <button onclick="sendMessage()" class="send-btn">Enviar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recursos Section -->
        <div id="resourcesSection" class="content-section">
            <h2>Recursos</h2>
            <div id="resourcesList" class="resources-list">
                <!-- Resources will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- User Menu -->
    <!-- Version 2.1 - Menu simplified, removed Mi Perfil -->
    <div id="userMenu" class="user-menu" style="display: none;">
        <div style="padding: 12px; cursor: pointer; border-radius: 8px; margin-bottom: 6px; transition: all 0.2s; color: #e0f7f7;" onclick="window.location.href='/home'" onmouseover="this.style.background='rgba(255,255,255,0.08)'; this.style.color='#ffffff';" onmouseout="this.style.background='transparent'; this.style.color='#e0f7f7';">
            üè† Inicio
        </div>
        <hr style="border: none; height: 1px; background: rgba(255,255,255,0.2); margin: 10px 0;">
        <div style="padding: 12px; cursor: pointer; border-radius: 8px; color: #ff6b6b; transition: all 0.2s;" onclick="logout()" onmouseover="this.style.background='rgba(255,107,107,0.1)';" onmouseout="this.style.background='transparent';">
            üö™ Cerrar Sesi√≥n
        </div>
    </div>

    <!-- Create Class Modal - MUST BE OUTSIDE CONTAINER -->
    <div id="createCourseModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeCreateCourseModal()">&times;</span>
            <h2>üìö Crear Nueva Clase</h2>
            
            <form id="createCourseForm" onsubmit="submitCreateCourse(event)">
                <!-- Step 1: Seleccionar Materia -->
                <div class="form-step active" id="step1">
                    <h3>1Ô∏è‚É£ Selecciona la Materia</h3>
                    <div class="subjects-grid">
                        <!-- Row 1 -->
                        <div class="subject-card" onclick="selectSubject('ciencias', 'üî¨', 'Ciencias')">
                            <div class="subject-icon">üî¨</div>
                            <div class="subject-name">Ciencias</div>
                            <div class="subject-stats">
                                <span>üë• 1234</span>
                                <span>üìñ 45</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('astronomia', 'üåå', 'Astronom√≠a')">
                            <div class="subject-icon">üåå</div>
                            <div class="subject-name">Astronom√≠a</div>
                            <div class="subject-stats">
                                <span>üë• 856</span>
                                <span>üìñ 28</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('biologia', 'üß¨', 'Biolog√≠a')">
                            <div class="subject-icon">üß¨</div>
                            <div class="subject-name">Biolog√≠a</div>
                            <div class="subject-stats">
                                <span>üë• 1567</span>
                                <span>üìñ 52</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('arte', 'üé®', 'Arte')">
                            <div class="subject-icon">üé®</div>
                            <div class="subject-name">Arte</div>
                            <div class="subject-stats">
                                <span>üë• 2341</span>
                                <span>üìñ 67</span>
                            </div>
                        </div>
                        
                        <!-- Row 2 -->
                        <div class="subject-card" onclick="selectSubject('ingles', 'üó£Ô∏è', 'Ingl√©s')">
                            <div class="subject-icon">üó£Ô∏è</div>
                            <div class="subject-name">Ingl√©s</div>
                            <div class="subject-stats">
                                <span>üë• 3456</span>
                                <span>üìñ 89</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('matematicas', 'üìê', 'Matem√°ticas')">
                            <div class="subject-icon">üìê</div>
                            <div class="subject-name">Matem√°ticas</div>
                            <div class="subject-stats">
                                <span>üë• 2890</span>
                                <span>üìñ 73</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('historia', 'üìö', 'Historia')">
                            <div class="subject-icon">üìö</div>
                            <div class="subject-name">Historia</div>
                            <div class="subject-stats">
                                <span>üë• 1678</span>
                                <span>üìñ 41</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('musica', 'üéµ', 'M√∫sica')">
                            <div class="subject-icon">üéµ</div>
                            <div class="subject-name">M√∫sica</div>
                            <div class="subject-stats">
                                <span>üë• 1234</span>
                                <span>üìñ 35</span>
                            </div>
                        </div>
                        
                        <!-- Row 3 -->
                        <div class="subject-card" onclick="selectSubject('programacion', 'üíª', 'Programaci√≥n')">
                            <div class="subject-icon">üíª</div>
                            <div class="subject-name">Programaci√≥n</div>
                            <div class="subject-stats">
                                <span>üë• 4567</span>
                                <span>üìñ 95</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('geografia', 'üåç', 'Geograf√≠a')">
                            <div class="subject-icon">üåç</div>
                            <div class="subject-name">Geograf√≠a</div>
                            <div class="subject-stats">
                                <span>üë• 987</span>
                                <span>üìñ 32</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('frances', 'FR', 'Franc√©s')">
                            <div class="subject-icon subject-text">FR</div>
                            <div class="subject-name">Franc√©s</div>
                            <div class="subject-stats">
                                <span>üë• 1456</span>
                                <span>üìñ 44</span>
                            </div>
                        </div>
                        
                        <div class="subject-card" onclick="selectSubject('quimica', '‚öóÔ∏è', 'Qu√≠mica')">
                            <div class="subject-icon">‚öóÔ∏è</div>
                            <div class="subject-name">Qu√≠mica</div>
                            <div class="subject-stats">
                                <span>üë• 1876</span>
                                <span>üìñ 56</span>
                            </div>
                        </div>
                    </div>
                    
                    <input type="hidden" id="selectedSubject" name="subject" required>
                    <input type="hidden" id="selectedSubjectIcon" name="subjectIcon">
                    
                    <div class="step-actions">
                        <button type="button" class="btn-secondary" onclick="closeCreateCourseModal()">Cancelar</button>
                        <button type="button" class="btn-primary" onclick="nextStep(2)" disabled id="btnStep1">Siguiente ‚Üí</button>
                    </div>
                </div>
                
                <!-- Step 2: Detalles de la Clase -->
                <div class="form-step" id="step2">
                    <h3>2Ô∏è‚É£ Detalles de la Clase</h3>
                    <div id="selectedSubjectDisplay" class="selected-subject-display"></div>
                    
                    <div class="form-group">
                        <label for="title">T√≠tulo de la Clase *</label>
                        <input type="text" id="title" name="title" placeholder="Ej: Introducci√≥n a la F√≠sica Cu√°ntica" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Descripci√≥n *</label>
                        <textarea id="description" name="description" rows="3" placeholder="Describe brevemente el contenido de la clase..." required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="difficulty">Dificultad *</label>
                            <select id="difficulty" name="difficulty" required>
                                <option value="">Selecciona...</option>
                                <option value="principiante">üü¢ Principiante</option>
                                <option value="intermedio">üü° Intermedio</option>
                                <option value="avanzado">üî¥ Avanzado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="deadline">Fecha L√≠mite de Entrega *</label>
                            <input type="datetime-local" id="deadline" name="deadline" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="objectives">Objetivos de Aprendizaje</label>
                        <textarea id="objectives" name="objectives" rows="2" placeholder="¬øQu√© aprender√°n los estudiantes? (Opcional)"></textarea>
                    </div>
                    
                    <div class="step-actions">
                        <button type="button" class="btn-secondary" onclick="previousStep(1)">‚Üê Anterior</button>
                        <button type="button" class="btn-primary" onclick="nextStep(3)">Siguiente ‚Üí</button>
                    </div>
                </div>
                
                <!-- Step 3: Asignar Estudiantes -->
                <div class="form-step" id="step3">
                    <h3>3Ô∏è‚É£ Asignar Estudiantes (Opcional)</h3>
                    <p style="margin-bottom: 15px; opacity: 0.8;">Los estudiantes tambi√©n pueden inscribirse por s√≠ mismos despu√©s de crear el curso.</p>
                    
                    <div class="students-selection">
                        <div class="search-students">
                            <input type="text" id="searchStudents" placeholder="üîç Buscar estudiante por nombre..." onkeyup="filterStudents()">
                            <div class="selection-actions">
                                <button type="button" class="btn-sm" onclick="selectAllStudents()">Seleccionar Todos</button>
                                <button type="button" class="btn-sm" onclick="deselectAllStudents()">Deseleccionar Todos</button>
                            </div>
                        </div>
                        
                        <div class="students-list" id="studentsList">
                            <!-- Students will be loaded here -->
                            <div class="loading">Cargando estudiantes...</div>
                        </div>
                        
                        <div class="selected-count">
                            <span id="selectedCount">0</span> estudiante(s) seleccionado(s)
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button type="button" class="btn-secondary" onclick="previousStep(2)">‚Üê Anterior</button>
                        <button type="submit" class="btn-primary">‚úÖ Crear Clase</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Class Modal -->
    <div id="editCourseModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeEditCourseModal()">&times;</span>
            <h2>‚úèÔ∏è Editar Clase</h2>
            
            <form id="editCourseForm" onsubmit="submitEditCourse(event)">
                <input type="hidden" id="editCourseId" name="courseId">
                
                <div class="form-section">
                    <h3>üìù Informaci√≥n de la Clase</h3>
                    
                    <div class="form-group">
                        <label for="editTitle">T√≠tulo de la Clase *</label>
                        <input type="text" id="editTitle" name="title" placeholder="Ej: Introducci√≥n a la F√≠sica Cu√°ntica" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editDescription">Descripci√≥n *</label>
                        <textarea id="editDescription" name="description" rows="3" placeholder="Describe brevemente el contenido de la clase..." required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCategory">Categor√≠a *</label>
                            <select id="editCategory" name="category" required>
                                <option value="">Selecciona...</option>
                                <option value="matematicas">Matem√°ticas</option>
                                <option value="ciencias">Ciencias</option>
                                <option value="historia">Historia</option>
                                <option value="idiomas">Idiomas</option>
                                <option value="arte">Arte</option>
                                <option value="musica">M√∫sica</option>
                                <option value="tecnologia">Tecnolog√≠a</option>
                                <option value="programacion">Programaci√≥n</option>
                                <option value="geografia">Geograf√≠a</option>
                                <option value="biologia">Biolog√≠a</option>
                                <option value="quimica">Qu√≠mica</option>
                                <option value="fisica">F√≠sica</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editDuration">Duraci√≥n (minutos) *</label>
                            <input type="number" id="editDuration" name="duration" min="15" max="240" step="15" value="60" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editScheduledAt">Fecha y Hora *</label>
                            <input type="datetime-local" id="editScheduledAt" name="scheduledAt" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editMaxStudents">Estudiantes M√°x. *</label>
                            <input type="number" id="editMaxStudents" name="maxStudents" min="1" max="100" value="20" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editStatus">Estado *</label>
                        <select id="editStatus" name="status" required>
                            <option value="scheduled">Programado</option>
                            <option value="active">En curso</option>
                            <option value="completed">Completado</option>
                            <option value="cancelled">Cancelado</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>üë• Gesti√≥n de Estudiantes</h3>
                    
                    <div class="student-management-help">
                        <p>üí° <strong>Agregar estudiantes:</strong> Dale acceso al curso. Podr√°n verlo en su dashboard.</p>
                        <p>üóëÔ∏è <strong>Quitar estudiantes:</strong> Elimina el acceso. Ya no podr√°n ver el curso.</p>
                    </div>
                    
                    <div class="current-students-info">
                        <div class="info-badge">
                            <span class="info-label">Estudiantes actuales:</span>
                            <span class="info-value" id="currentStudentsCount">0</span>
                        </div>
                        <div class="info-badge">
                            <span class="info-label">Capacidad m√°xima:</span>
                            <span class="info-value" id="maxStudentsDisplay">20</span>
                        </div>
                    </div>
                    
                    <div class="students-tabs">
                        <button type="button" class="student-tab active" onclick="switchStudentTab('enrolled')">
                            Estudiantes Inscritos (<span id="enrolledCount">0</span>)
                        </button>
                        <button type="button" class="student-tab" onclick="switchStudentTab('available')">
                            Agregar Estudiantes (<span id="availableCount">0</span>)
                        </button>
                    </div>
                    
                    <div class="students-tab-content">
                        <!-- Enrolled Students Tab -->
                        <div id="enrolledStudentsTab" class="tab-pane active">
                            <div class="search-box">
                                <input type="text" id="searchEnrolled" placeholder="üîç Buscar estudiante inscrito..." onkeyup="filterEnrolledStudents()">
                            </div>
                            <div class="enrolled-students-list" id="enrolledStudentsList">
                                <div class="loading">Cargando estudiantes...</div>
                            </div>
                        </div>
                        
                        <!-- Available Students Tab -->
                        <div id="availableStudentsTab" class="tab-pane">
                            <div class="search-box">
                                <input type="text" id="searchAvailable" placeholder="üîç Buscar estudiante..." onkeyup="filterAvailableStudents()">
                                <div class="selection-actions">
                                    <button type="button" class="btn-sm" onclick="selectAllAvailable()">Seleccionar Todos</button>
                                    <button type="button" class="btn-sm" onclick="deselectAllAvailable()">Deseleccionar Todos</button>
                                </div>
                            </div>
                            <div class="available-students-list" id="availableStudentsList">
                                <div class="loading">Cargando estudiantes...</div>
                            </div>
                            <div class="selected-count">
                                <span id="newStudentsCount">0</span> estudiante(s) seleccionado(s) para agregar
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditCourseModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">üíæ Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Class Modal -->
    <div id="manageClassModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeManageClassModal()">&times;</span>
            <h2>üìä Gesti√≥n de Clase</h2>
            
            <div class="class-overview">
                <h3 id="manageClassName">Nombre de la Clase</h3>
                <div class="class-overview-stats">
                    <div class="stat-item">
                        <label>Estudiantes Inscritos</label>
                        <span class="stat-value" id="enrolledCount">0</span>
                    </div>
                    <div class="stat-item">
                        <label>Han Asistido</label>
                        <span class="stat-value" id="attendedCount">0</span>
                    </div>
                    <div class="stat-item">
                        <label>Completaron</label>
                        <span class="stat-value" id="completedCount">0</span>
                    </div>
                    <div class="stat-item">
                        <label>Estado</label>
                        <span class="stat-value" id="classStatusBadge">Programado</span>
                    </div>
                </div>
            </div>

            <div class="manage-tabs">
                <button type="button" class="manage-tab active" onclick="switchManageTab('attendance')">
                    Asistencia
                </button>
                <button type="button" class="manage-tab" onclick="switchManageTab('progress')">
                    Progreso
                </button>
                <button type="button" class="manage-tab" onclick="switchManageTab('details')">
                    Detalles
                </button>
            </div>

            <div class="manage-content">
                <!-- Attendance Tab -->
                <div id="attendancePane" class="manage-pane active">
                    <div class="attendance-list" id="attendanceList">
                        <div class="loading">Cargando estudiantes...</div>
                    </div>
                </div>

                <!-- Progress Tab -->
                <div id="progressPane" class="manage-pane">
                    <div class="progress-list" id="progressList">
                        <div class="loading">Cargando progreso...</div>
                    </div>
                </div>

                <!-- Details Tab -->
                <div id="detailsPane" class="manage-pane">
                    <div class="class-details" id="classDetails">
                        <div class="loading">Cargando detalles...</div>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeManageClassModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Day Classes Modal -->
    <div id="dayClassesModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="dayClassesTitle">Clases del D√≠a</h3>
                <button class="close-modal" onclick="closeDayClassesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="dayClassesList" class="day-classes-list">
                    <!-- Classes will be loaded here -->
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeDayClassesModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        function toggleUserMenu(event) {
            event.stopPropagation();
            const menu = document.getElementById('userMenu');
            
            if (menu.style.display === 'none' || !menu.style.display) {
                menu.style.display = 'block';
                // El CSS maneja el posicionamiento
            } else {
                menu.style.display = 'none';
            }
        }
        
        // Function to navigate to user's profile/dashboard
        function goToMyProfile() {
            // El tutor ya est√° en su dashboard, solo cerramos el men√∫
            const menu = document.getElementById('userMenu');
            if (menu) menu.style.display = 'none';
            
            // Scroll to top para mostrar la informaci√≥n del perfil
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        document.addEventListener('click', () => {
            const menu = document.getElementById('userMenu');
            if (menu) menu.style.display = 'none';
        });
    </script>
    
    <!-- Load API version without Firebase -->
    <script src="/js/api-service.js?v=22"></script>
    <script src="/js/tutor-dashboard-api.js?v=22"></script>
</body>
</html>
